<script>
    // Конфигурация Firebase
    const firebaseConfig = {
        apiKey: "AIzaSyD3EDKVbNdPHBhMNGFB4RTnk8QNVMeg1Ho",
        authDomain: "danah-school-db.firebaseapp.com",
        projectId: "danah-school-db",
        storageBucket: "danah-school-db.firebasestorage.app",
        messagingSenderId: "400447808100",
        appId: "1:400447808100:web:585a7f81f7d3b138d7b571",
        measurementId: "G-S62J55TS5X"
    };

    // Инициализация Firebase
    const app = firebase.initializeApp(firebaseConfig);
    const auth = firebase.getAuth(app);
    const db = firebase.firestore(app); // Инициализация Firestore

    // Обработчик входа
    document.getElementById('loginForm').addEventListener('submit', async (e) => {
        e.preventDefault();

        const email = document.getElementById('email').value.trim();
        const password = document.getElementById('password').value.trim();

        // Проверка заполненности полей
        if (!email || !password) {
            alert('Пожалуйста, заполните все поля.');
            return;
        }

        try {
            // Попытка входа
            const userCredential = await firebase.signInWithEmailAndPassword(auth, email, password);
            const user = userCredential.user; // Получение данных о пользователе
            console.log('Пользователь вошел в систему:', user);

            alert('Успешный вход!');

            // Сохранение данных пользователя в Firestore
            const userData = {
                email: user.email,
                lastLogin: new Date().toISOString()
            };

            await db.collection('users').doc(user.uid).set(userData, { merge: true });
            console.log('Данные пользователя обновлены:', userData);

            // Перенаправление на главную страницу
            window.location.href = 'main.html';
        } catch (error) {
            console.error('Ошибка входа:', error);

            // Обработка распространенных ошибок
            switch (error.code) {
                case 'auth/user-not-found':
                    alert('Пользователь не найден. Проверьте введенные данные.');
                    break;
                case 'auth/wrong-password':
                    alert('Неверный пароль. Попробуйте снова.');
                    break;
                case 'auth/invalid-email':
                    alert('Неверный формат электронной почты.');
                    break;
                default:
                    alert(`Произошла ошибка: ${error.message}`);
            }
        }
    });
</script>
